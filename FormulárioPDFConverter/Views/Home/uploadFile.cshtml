@model FormulárioPDFConverter.Models.DocumentosViewModel

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <meta charset="utf-8" />
    @{
        ViewBag.Title = "Enviar Documentos:";
        var ID_Empresa = Session["ID_Empresa"];
    }
    <style>
        .document-step {
            margin-bottom: 1em;
        }

        .pendenteRed {
            color: #ff0000;
        }

        .enviadaoBlue {
            color: #111df3;
        }
    </style>
</head>
<body style="background-color: #6a6a6a63;">

    <div class="container mt-3">
        <div class="alert alert-info">
            <p class="document-step">
                <strong>1º Passo:</strong> Preencher e assinar a ficha de inscrição:
                @Html.ActionLink("Clique aqui", "FichaIncricao", "Home", new { ID_Empresa = ID_Empresa }, new { @style = "text-decoration: underline;" })
            </p>
            <p class="document-step">
                <strong>2º Passo:</strong> Incluir a ficha de inscrição em <b><i>"Incluir Documentos"</i></b>
            </p>
            <p class="document-step">
                <strong>3º Passo:</strong> Incluir demais documentos em <b><i>"Incluir Documentos"</i></b>
            </p>
            <p class="document-step">
                <b>Incluir:</b> Contrato social; <br>
                Cartão CNPJ.
            </p>
        </div>
    </div>

    <div class="container mt-3">
        <div class="card" style="border-radius: 1.25rem;">
            <div class="card-header" style="background-color: #00000099;">
                <h3 class="mb-0" style="color: #fcfcff"><b>Incluir Documentos:</b></h3>
            </div>
            <div class="card-body">
                @using (Html.BeginForm("UploadFile", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()

                    <div class="form-group">
                        <label for="fileUpload">Escolha o documento que irá enviar:</label>
                        <input type="file" class="form-control-file" id="fileUpload" name="fileUpload" accept=".pdf,.doc,.docx">
                    </div>

                    <select class="custom-select col-md-12" id="documentType" name="documentType" required>
                        <option value="" disabled selected>Selecione o tipo de documento:</option>
                        <option value="Ficha-de-Inscricao-">Ficha de Inscrição</option>
                        <option value="Contrato-Social-">Contrato Social</option>
                        <option value="Cartao-CNPJ-">Cartão CNPJ</option>
                        <option value="Procuracao-">Procuracao</option>
                    </select>

                    @Html.Hidden("CNPJ", Model.DadosCadastro.CNPJ)
                    @Html.Hidden("ID_Empresa", Model.DadosCadastro.ID_Empresa)

                    <br />
                    <br />
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Enviar Documento</button>
                    </div>
                }
            </div>
        </div>
    </div>


    <div class="container mt-4">
        <div class="card" style="border-radius: 1.25rem;">
            <div class="card-header" style="background-color: #00000099;">
                <h3 class="mb-0" style="color: #fcfcff"><b>Documentos:</b></h3>
            </div>
            <div class="card-body">
                @if (Model.TiposDocumentos.Any())
                {
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>CNPJ</th>
                                <th>Documentos</th>
                                <th>Data de Inclusão</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var tipoDocumento in Model.TiposDocumentos)
                            {
                                var cnpjFormatado = Model.DadosCadastro.CNPJ.Replace(".", "").Replace("/", "").Replace("-", "");
                                var documentoEnviado = Model.Documentos.FirstOrDefault(doc => doc.TipoDocumento.Equals(tipoDocumento + cnpjFormatado, StringComparison.InvariantCultureIgnoreCase));

                                var documentoLink = documentoEnviado != null ? Url.Content("~/Uploads/" + documentoEnviado.TipoDocumento + ".pdf") : null;

                                <tr>
                                    <td><b>@Model.DadosCadastro.CNPJ</b></td>
                                    <td>
                                        @if (documentoEnviado != null)
                                        {
                                            <a href="@documentoLink" target="_blank"><b>@tipoDocumento.Replace("-", " ")</b></a> }
                                        else
                                        {
                                            <b>@tipoDocumento.Replace("-", " ")</b>}
                                    </td>
                                    <td>
                                        @if (documentoEnviado != null && documentoEnviado.DataInclusao != null)
                                        {
                                            <span class="enviadaoBlue"><b>@documentoEnviado.DataInclusao.ToString("dd/MM/yyyy HH:mm:ss")</b></span><br /> }
                                        else
                                        {
                                            <span class="pendenteRed"><b>Pendente</b></span>}
                                    </td>
                                    <td>
                                        @if (documentoEnviado != null)
                                        {
                                            <span class="enviadaoBlue"><b>Enviado</b></span> }
                                        else
                                        {
                                            <span class="pendenteRed"><b>Pendente</b></span>}
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table> }
                else
                {
                    <p class="pendenteRed"><b>Nenhum Tipo de Documento Encontrado</b></p>
                }
            </div>
        </div>
    </div>

    @if (TempData["AlertMessage"] != null)
    {
        <script type="text/javascript">
            alert('@TempData["AlertMessage"]');
        </script>
    }

</body>
</html>